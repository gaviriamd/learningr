---
editor_options:
  markdown:
    wrap: sentence
  chunk_output_type: console
output: 
  html_document: 
    toc: true
    df_print: default
---

::: {style="text-align: justify"}
# **Libro de Tareas de Juan D. Gaviria S.**
# ***Diplomado en Bioestadística***
# ***Universidad Manuela Beltrán***

## ***Módulo 2: Profesor Fredy Medina***

```{r Housekeeping, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
date() # Current system time and date.
R.version.string # R version and version release date.
options(digits=6) # Confirm default digits.
options(scipen=999)# Suppress scientific notation.
options(width=60) # Confirm output width.
ls() # List all objects in the working directory.
rm(list = ls()) # CAUTION: Remove all files in the
ls.str() # List all objects with finite detail.
getwd() # Identify the current working directory.
setwd("C:/Users/juand/iCloudDrive/Biostatistics/CME/2024 - Diplomado en Bioestadística/02 - Estadística Descriptiva") #Copy & Paste the 
getwd() # Confirm the working directory.
load("DBS.RDATA")
list.files() # List files at the PC directory.
.libPaths() # Library pathname.
.Library # Library pathname.
sessionInfo() # R version, locale, and packages.
search() # Attached packages and objects.
searchpaths() # Attached packages and objects.sto
par("mar") # Confirm default margin (BLTR)
par(mar = c(5.1, 4.1, 4.1, 2.1)) #adjust plot margins
```

## ***Cargar librerías***

```{r Libraries, message=TRUE, warning=FALSE}
library(grid)
library(gridExtra)
library(tidyverse)
library(plotly)
library(DT)
library(utf8)
library(readr)
library(ggplot2)
library(DiagrammeR)
library(modeest)
```


```{r Cargar dataset}
rm(list = ls())

url_base= 'https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data'

dat.df <- read.table(url_base, header = TRUE, sep = ",", quote = "", fill = TRUE)

names(dat.df) <- c( "age", "sex", "cp", "trestbps", "chol","fbs", "restecg","thalach","exang", "oldpeak","slope", "ca", "thal", "num")

datatable(dat.df)
```

## ***CodeBook***
"age", "sex", "cp", "trestbps", "chol","fbs", "restecg","thalach","exang", "oldpeak","slope", "ca", "thal", "num"\
age: edad del paciente\
sex: Sexo del paciente\
cp: Tipo de dolor en el pecho\
Tipo 1: Angina típica\
Tipo 2: Angina Atípica\
Tipo 3: Dolor no anginal\
Tipo 4: Asintomático\
trestbps: Presión arterial en reposo en mm Hg al ingreso al hospital\
chol: Colesterol sérico en mg /dl\
fbs: azúcar en sangre en ayunas \> 120 mg/dl\
restecg: Resultados electrocardiográficos en reposo\
Nivel 0: Normal\
Nivel 1: Tener anormalidad de onda ST-T (inversiones de onda T y / o elevación o Depresión de ST de \> 005 mV)\
Nivel 2: Muestra hipertrofía ventricular izquierda probable o definitiva según los criterios de Estes.\
thalach: Frecuencia cardiaca máxima alcanzada\
exang: Angina inducida por el ejercicio\
oldpeak: Depresión del ST inducida por el ejercicio en relación con el descanso\
slope: La pendiente del segmento ST de ejercicio pico\
Valor 1: ascenso\
Valor 2: plano\
Valor 3: descenso\
ca: Numero de vasos principales (0-3) coloreados por fluoroscopia\
thal: El estado del corazón según la prueba de Thallium\
N = normal;\
DF = defecto fijo\
DR = defecto reversible\
num : Presencia de enfermedad cardíaca (estado de enfermedad angiográfica)\
0: Saludable\
1: Diagnosticado como etapa 1\
2: Diagnosticado como etapa 2\
3: Diagnosticado como etapa 3\
4: Diagnosticado como etapa 4

### ***Ejercicio 1.*** 
Clasifique cada una de estas variables y transforme todas las que sean necesarias con los métodos descritos en el documento.

```{r Transformando variables, message=FALSE, warning=FALSE}
str(dat.df)
glimpse(dat.df)

# Variable Sex
dat.df$sex[dat.df$sex==1]<- "Masculino" # asigna Masculino a el valor 1 en la columna sex
dat.df$sex[dat.df$sex==0]<- "Femenino"  # asigna femenino a el valor 0 en la columna sex

# Variable cp
dat.df$cp[dat.df$cp==1]<- "Angina Típica"
dat.df$cp[dat.df$cp==2]<- "Angina Atípica"
dat.df$cp[dat.df$cp==3]<- "Dolor no Anginal"
dat.df$cp[dat.df$cp==4]<- "Asintomático"

# Variable fbs (azúcar en sangre en ayunas > 120 mg/dl)
dat.df$fbs[dat.df$fbs==0]<- "azúcar en sangre en ayunas ≤ 120 mg/dl"
dat.df$fbs[dat.df$fbs==1]<- "azúcar en sangre en ayunas > 120 mg/dl"

# Variable restecg (Resultados electrocardiográficos en reposo)
dat.df$restecg[dat.df$restecg==0]<- "Normal"
dat.df$restecg[dat.df$restecg==1]<- "Tener anormalidad de onda ST-T (inversiones de onda T y / o elevación o Depresión de ST de > 005 mV)"
dat.df$restecg[dat.df$restecg==2]<- "Muestra hipertrofía ventricular izquierda probable o definitiva según los criterios de Estes."

# Variable exang (Angina inducida por el ejercicio)
dat.df$exang[dat.df$exang==0]<- "No"
dat.df$exang[dat.df$exang==1]<- "Si"

# Variable slope (La pendiente del segmento ST de ejercicio pico)
dat.df$slope[dat.df$slope==1]<- "Ascenso"
dat.df$slope[dat.df$slope==2]<- "Plano"
dat.df$slope[dat.df$slope==3]<- "Descenso"

# Variable thal (El estado del corazón según la prueba de Thallium)
dat.df$thal[dat.df$thal=="3.0"]<- "Normal"
dat.df$thal[dat.df$thal=="6.0"]<- "Defecto Fijo"
dat.df$thal[dat.df$thal=="7.0"]<- "Defecto Reversible"
dat.df$thal[dat.df$thal=="?"]<- "NA"

# Variable num (Presencia de enfermedad cardíaca (estado de enfermedad angiográfica)
dat.df$num[dat.df$num==0]<- "Saludable"
dat.df$num[dat.df$num==1]<- "Etapa 1"
dat.df$num[dat.df$num==2]<- "Etapa 2"
dat.df$num[dat.df$num==3]<- "Etapa 3"
dat.df$num[dat.df$num==4]<- "Etapa 4"


# Cambiando variables de character a factos y numeric a integer.

dat.df$sex <- as.factor(dat.df$sex)
dat.df$cp <- as.factor(dat.df$cp)
dat.df$fbs <- as.factor(dat.df$fbs)
dat.df$restecg <- as.factor(dat.df$restecg)
dat.df$exang <- as.factor(dat.df$exang)
dat.df$slope <- as.factor(dat.df$slope)
dat.df$thal <- as.factor(dat.df$thal)
dat.df$num <- as.factor(dat.df$num)

dat.df$age <- as.integer(dat.df$age)
dat.df$trestbps <- as.integer(dat.df$trestbps)
dat.df$chol <- as.integer(dat.df$chol)
dat.df$thalach <- as.integer(dat.df$thalach)
dat.df$ca <- as.integer(dat.df$ca)

str(dat.df)
glimpse(dat.df)
```

#### ***Ejercicio 2.***

Con este resumen de los datos, describe cada una de las variables en cuanto a su comportamiento y el sentido de estos valores.

Con respecto a los valores faltantes o no existentes, la función summary() también proporciona un resumen que incluye la cantidad de valores NA por columna.
Además, lo podemos hacer de la siguiente manera:

```{r NAs y Summary Data}
apply(is.na(dat.df), 2, sum)

summary(dat.df)
```

**age**: La edad de los pacientes se encuentran entre los 29 y los 77 años con media de 54 años y mediana de 55 años (una leve desviación hacia la derecha de los dato.)\
**sex**: El sexo de los pacientes es de 97 participantes mujeres y 205 hombres.\
**cp**: El tipo de dolor en el pecho de esta población es predominántemente no anginoso (n = 86)\
**trestbps**: La presión arterial ¿sistólica? en reposo en mm Hg al ingreso al hospital de los pacientes estuvo entre 94 mmHg y 200 mmHg, con una media de 131 mmHg y mediana de 130 mmHg (Una leve desviación de los datos hacia la izquierda)\
**chol**: El Colesterol sérico en mg/dl de los participantes se encontre entre 126 mg/dl y 256 mg/dl con una media de 246 mg/dl y mediana de 241 mg/dl (desviación de los datos hacia la izquierda)\
**fbs**: El azúcar en sangre en ayunas > 120 mg/dl se encontró en 44 de de los pacientes.\
**restecg**: Los resultados electrocardiográficos en reposo de los pacientes de acuerdo con los criterios de Estes, fueron normales en 151 de los pacientes y s encontró hipertrofia ventricular izquierda probable o definitiva en 147 de ellos.\
**thalach**: La frecuencia cardiaca máxima alcanzada en los participantes estuvo entre 71 lpm y 202 lpm, con una media de 149 lpm y mediana de 153 lmp (con una desviación de los datos hacia la derecha)\
**exang**: La Angina inducida por el ejercicio se presentó en 99 de los participantes\
**oldpeak**: La depresión del ST inducida por el ejercicio en relación con el descanso estuvo entre 0 y 6.2 con media de 1 y mediana de 0.8\
**slope**: La pendiente del segmento ST de ejercicio pico fue plana en 140 participantes en descenso en 20 y en ascenso en 142 de ellos\
**ca**: Los participantes tuvieron entre 1 y 4 3 vasos principales coloreados por fluoroscopia, con una mediana de 1 vaso coloredo por fluoroscopia. Adicionalmente no se encontraron datos para 4 de los pacientes\
**thal**: El estado del corazón según la prueba de Thallium, 166 pacientetuvieron un examen normal, 117 mostraron un defecto reversible, 17 un defecto fijo y no hubo información en 2 casos.\
**num**: La mayoría de los participantes (n=163) no presentaron enfermedad cardíaca, los mayormente afectados (n=55) se encontraban en Etapa 1. En la Etapa 4 de la enfermedad sólo se encontraron a 13 pacientes.


#### ***Ejercicio 3.***

Transforme la variable "num" en sus categóricas y describa como puede interpretar el siguiente gráfico.

```{r Edad Agrupada, warning=FALSE}
dat.df$age_group <- cut(dat.df$age, breaks=seq(20, 80, by=5), include.lowest=TRUE)
```


```{r Gráfica de Barras}
ggplot(dat.df, aes(x=factor(age_group), fill=factor(num))) +
  geom_bar(color="black") +
  labs(title="Presencia de enfermedad cardiaca (Estado de Enfermedad Angiográfica)", x="Sexo", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()
#num : Presencia de enfermedad cardíaca (estado de enfermedad angiográfica)   
#  0: Saludable 
#  1: Diagnosticado como etapa 1
#  2: Diagnosticado como etapa 2
#  3: Diagnosticado como etapa 3
#  4: Diagnosticado como etapa 4
```

La gráfica anterior muestra barras agrupadas por rangos de edades, y en cada barra se representa el estado de la enfermedad angiográfica.

Allí podemos observar que la mayoría de la población es cardiacamente saludable (naranja), y aquella que no lo es se encuentra sobre todo en la Etapa 1 de la enfermedad, seguido de la Etapa 2. Podemos ver que la población más frecuente se encuentra entre los 55 y 60 años. Asi mismo vemos que las edades de la población no se encuentran tan normalmente distribuida, ya que si bien esta se encuentra, principalmente, entre los 50 y 65 años, hay un grupo importante que se encuentra entre los 40 y 45 años. 

```{r Boxplot}

boxplot(dat.df$age, xlab = "Edades",col = "lightblue",bg = 'transparent',horizontal = T)
```

¿Qué interpretación le puede dar a la anterior gráfica con respecto a los datos?

El gráfico muestra que la edad mínima de los pacientes es de 27 años, mientras que la edad máxima es de 77 años.
El promedio de edad es de 54 años, con una mediana de 56 años, lo que indica una ligera asimetría negativa en la distribución de la edad, ya que la mediana es mayor que la media.
Esta asimetría se puede apreciar en el histograma, donde la línea roja marca la media y la línea negra la mediana.
La desviación estándar de las edades es de 9.03 años, lo que sugiere una variación moderada respecto a la media.
Además, se observa una mayor concentración de pacientes entre los 50 y 60 años.
En el diagrama de cajas, se puede ver que el 25% de los pacientes tienen menos de 48 años, el 50% menos de 56 años, y el 75% menos de 61 años.

La siguiente gráfica permite evidenciar la dispersión de los datos en cuanto a la edad y la presión en reposo, junto con una asignación por colores de las categorías para la variable thal (el estado del corazón según la prueba de Thallium).

¿Tiene algún sentido el valor "NA" en la gráfica?

responda: No, ya que hace referencia a los missing values, de manera que no tiene sentido que aparezcan en el gráfico de dispersión. En este caso, lo que habría que hacer es convertir esos NAs en valores de moda para que puedan ingresar dentro del gráfico de dispersión y tenga relevancia.

```{r Convertir NAs en Moda}

```

```{r Gráfico de Dispersión}
# Suponiendo que las variables a graficar son thal, age y trestbps (presión sanguínea en reposo)
ggplot(dat.df, aes(x=age, y=trestbps, color=factor(thal))) +
  geom_point(size=3) +
  labs(title="Relación entre Edad, Presión en Reposo y Thal",
       x="Edad", y="Presión Sanguínea en Reposo", color="Thal") +
  theme_minimal()
```

#### ***Ejercicio 4.***

Complete todo el análisis descriptivo de cada una de las variables junto con la interpretación de las gráficas correspondientes.
Para esto, utilice diferentes gráficos y las medidas de variabilidad.

```{r 1. Age}
sexh <- ggplot(dat.df, aes(x=age)) +
  geom_histogram(color="black") +
  labs(title="Histogram", x="Edad", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

sexd <- ggplot(dat.df, aes(x=age)) +
  geom_density(color="black") +
  labs(title="Density Plot", x="Sexo", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

sexb <- ggplot(dat.df, aes(x=age)) +
  geom_boxplot(color="black") +
  labs(title="BoxPlot", x="Sexo", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

gridExtra::grid.arrange(
  sexh,
  sexd,
  sexb,
  ncol=2, nrow=2,
  top = textGrob("Edad (Años)",
                 gp=gpar(fontsize=15,
                         font=1)))

summary(dat.df$age)

```
Como podemos ver, la variable edad en esta población tiene una distribución asimétrica con una desviación hacia la izquierda (negativa) donde la mediana es mayor que la media. 

```{r 2. sex}
ggplot(dat.df, aes(x=sex)) +
  geom_bar(color="black") +
  labs(title="BarPlot: Sexo", x="Sexo", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

summary(dat.df$sex)

```
Como podemos ver, en la variable sexo, es másculino es quien presenta una mayor proporción con respecto al femenino.  

```{r 3. cp}
ggplot(dat.df, aes(x=cp)) +
  geom_bar(color="black") +
  labs(title="BarPlot: Tipo de dolor torácico", x="Tipo de dolor", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

summary(dat.df$cp)

```
Como podemos ver, la gran mayoría de pacientes es asintomático (n=144), seguido del dolor no anginoso (n=86)

```{r 4. trestbps}
tresh <- ggplot(dat.df, aes(x=trestbps)) +
  geom_histogram(color="black") +
  labs(title="Histogram", x="Presión Arterial Sistólica", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

tresd <- ggplot(dat.df, aes(x=trestbps)) +
  geom_density(color="black") +
  labs(title="Density Plot", x="Presión Arterial Sistólica", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

tresb <- ggplot(dat.df, aes(x=trestbps)) +
  geom_boxplot(color="black") +
  labs(title="BoxPlot", x="Presión Arterial Sistólica", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

gridExtra::grid.arrange(
  tresh,
  tresd,
  tresb,
  ncol=2, nrow=2,
  top = textGrob("Presión Artreial Sistólica (mmHg)",
                 gp=gpar(fontsize=15,
                         font=1)))

summary(dat.df$trestbps)

```
Como podemos ver, la presión arterial en esta población se encuentra asimétrica con desviación hacia la derecha (positiva) donde la media es mayor que la mediana, y esto se debe a que como se ve en el boxplot hay presencia de outlieres hacia los valores más altos de presión arterial.


```{r 5. chol}
cholh <- ggplot(dat.df, aes(x=chol)) +
  geom_histogram(color="black") +
  labs(title="Histogram", x="Colesterol", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

chold <- ggplot(dat.df, aes(x=chol)) +
  geom_density(color="black") +
  labs(title="Density Plot", x="Colesterol", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

cholb <- ggplot(dat.df, aes(x=chol)) +
  geom_boxplot(color="black") +
  labs(title="BoxPlot", x="Colesterol (mg/dL)", y="Número de Personas") +
  scale_fill_brewer(palette="Set1") +  # Aplicar una paleta de colores de RColorBrewer
  theme_bw()

gridExtra::grid.arrange(
  cholh,
  chold,
  cholb,
  ncol=2, nrow=2,
  top = textGrob("Colesterol (mg/dl)",
                 gp=gpar(fontsize=15,
                         font=1)))

summary(dat.df$chol)

```
Como podemos ver, también las cifras de colesterol en estaesta población se encuentra asimétrica con desviación hacia la derecha (positiva) donde la media es mayor que la mediana, y esto se debe a que como se ve en el boxplot hay presencia de outlieres hacia los valores más altos de colesterol.

#### ***Ejercicio 5.***
Redacte al menos 5 conclusiones.
1. Esta es una población en general libre de enfermedad cardiaca.
2. La población tiene en su mayoría distribuciones no normales. 
3. La mayor parte de la población afectada está en los primeros estadios de la enfermedad cardiaca.
4. La población más anciana es quien más tiene enfermedad cardiaca avanzada.
5. Las gráficas permiten visualizar patrones de la distribución de las variables en la población de estudio, apoyados por los valores de las medidas de localización y variabilida. 

```{r Exit, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
getwd() # Identify the current working directory.
ls() # List all objects in the working
# directory.
ls.str() # List all objects, with finite detail.
list.files() # List files at the PC directory.
save.image("DBS.rdata")
getwd() # Identify the current working directory.
ls() # List all objects in the working
# directory.
ls.str() # List all objects, with finite detail.
list.files() # List files at the PC directory.
alarm() # Alarm, notice of upcoming action.
q() # Quit this session.
# Prepare for Save workspace image? query.
```

:::
